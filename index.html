<!DOCTYPE html>  
<html lang="ar" dir="rtl">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-35NPHCGB93"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-35NPHCGB93');
  </script>

  <link rel="apple-touch-icon" href="1024.png">
  <link rel="icon" href="1024.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØºÙŠØ§Ø¨</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #006699;
      --secondary: #00aed9;
      --text-dark: #2c3e50;
      --safe: #22c55e;
      --warning: #facc15;
      --orange: #fb923c;
      --danger: #ef4444;
      --bg-gradient: linear-gradient(135deg, #e6f4f8 0%, #ffffff 100%);
      --info-modal-bg: #ffffff;
      --info-modal-text: #1f2937;
      --info-modal-accent: #0EA5E9;
    }
    .num{ direction: ltr; unicode-bidi: bidi-override; display: inline-block; font-weight: 800; }
    .formula-line{ direction: rtl; unicode-bidi: isolate-override; text-align: center; white-space: nowrap; }
    body { margin: 0; font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif; background: var(--bg-gradient); padding: 20px 10px; direction: rtl; min-height: 100vh; }
    .install-banner { background: #ffffff; border: 1px solid #e1e9e7; padding: 4px 12px; border-radius: 14px; margin-bottom: 14px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 3px 8px rgba(0,0,0,0.03); }
    .install-text { font-weight: 600; color: var(--primary); font-size: 0.78rem; }
    .install-btn { background: var(--secondary); color: white; border: none; padding: 4px 12px; border-radius: 10px; font-size: 0.72rem; font-weight: bold; cursor: pointer; }
    .app-container { max-width: 450px; margin: 0 auto; }
    .header-text h1 { text-align: center; margin: 0; font-size: clamp(1.9rem, 4.8vw, 2.5rem); font-weight: 800; color: var(--primary); letter-spacing: 0.3px; }
    .action-bars { display: flex; gap: 10px; margin: 20px 0; }
    .add-btn { flex: 2; padding: 14px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; border: none; border-radius: 16px; font-weight: bold; cursor: pointer; font-size: 1.05rem; box-shadow: 0 4px 12px rgba(0, 102, 153, 0.2); }
    .reset-all { flex: 1; padding: 12px; background: #fff; color: var(--primary); border: 1px solid var(--primary); border-radius: 16px; cursor: pointer; font-weight: bold; }
    .course-card { background: white; border-radius: 28px; padding: 22px; margin-bottom: 20px; box-shadow: 0 12px 30px rgba(0,0,0,0.06); border: 1px solid #d1e2e8; position: relative; }
    .delete-course { position: absolute; top: 18px; left: 18px; background: #fee2e2; color: #ef4444; border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .course-title { width: 85%; border: none; border-bottom: 2px solid #f0f0f0; font-size: 1.1rem; font-weight: bold; color: var(--primary); margin-bottom: 15px; padding: 5px; outline: none; background: transparent; }
    .input-group label { display: block; font-size: 0.9rem; color: #334155; margin-bottom: 6px; font-weight: 800; background: #f0f7f9; padding: 6px 12px; border-right: 3px solid var(--secondary); }
    .input-sub-label { font-size: 0.8rem; color: #666; margin-bottom: 4px; display: flex; align-items: center; justify-content: center; font-weight: 600; width: 100%; white-space: nowrap; }
    .info-icon { display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: var(--info-modal-accent); color: white; border-radius: 999px; font-size: 0.78rem; margin-right: 6px; cursor: pointer; font-weight: 900; vertical-align: middle; }
    .result-area { border-radius: 20px; padding: 15px; margin-top: 15px; text-align: center; }
    .safe-bg { background: #f0fdf4; border: 1px solid #dcfce7; }
    .warning-bg { background: #fffbeb; border: 1px solid #fef3c7; }
    .danger-bg { background: #fef2f2; border: 1px solid #fee2e2; }
    .progress-bar { height: 8px; background: #e5e7eb; border-radius: 4px; margin: 10px 0; overflow: hidden; }
    .progress-fill { height: 100%; width: 0%; transition: 0.8s ease-in-out; }
    .advice-box { margin-top: 10px; padding-top: 10px; border-top: 1px dashed rgba(0,0,0,0.1); font-size: 0.85rem; color: #444; line-height: 1.4; }
    .footer-note { text-align: center; font-size: 0.8rem; color: #718096; margin-top: 40px; border-top: 1px solid #d1d9e6; padding-top: 20px; }
    .primary-num { color: var(--primary); font-weight: 900; }
    .info-overlay{ display:none; position:fixed; inset:0; background: rgba(15, 23, 42, 0.55); z-index: 10000; justify-content:center; align-items:center; padding: 14px; }
    .info-modal{ width: 92%; max-width: 360px; background: var(--info-modal-bg); color: var(--info-modal-text); border-radius: 20px; box-shadow: 0 18px 45px rgba(0,0,0,0.25); overflow: hidden; }
    .info-modal-header{ display:flex; align-items:center; justify-content:space-between; padding: 14px 16px; border-bottom: 1px solid rgba(15, 23, 42, 0.08); }
    .info-modal-title{ display:flex; align-items:center; gap:10px; font-weight: 900; font-size: 0.95rem; }
    .info-badge{ width: 28px; height: 28px; border-radius: 10px; display:flex; align-items:center; justify-content:center; background: #e0f2fe; color: var(--info-modal-accent); font-weight: 900; }
    .info-close{ background: transparent; border: none; color: #475569; font-size: 1.1rem; cursor: pointer; padding: 6px 10px; }
    .info-modal-body{ padding: 14px 16px 6px 16px; font-size: 0.92rem; line-height: 1.7; }
    .info-modal-footer{ padding: 12px 16px 16px 16px; }
    .info-ok{ width:100%; background: var(--info-modal-accent); color: white; border: none; border-radius: 14px; padding: 12px 14px; font-weight: 900; cursor: pointer; }
    select, input { width: 100%; height: 42px; padding: 5px; border-radius: 12px; border: 1.5px solid #edf2f1; text-align: center; font-size: 0.95rem; font-weight: 800; outline: none; background-color: #eeeeee; color: #006699; }
    .flex-inputs { display: flex; gap: 5px; align-items: flex-end; }
    .flex-inputs > div { flex: 1; min-width: 0; }
  </style>
</head>

<body>
  <div id="guideModal" class="info-overlay" onclick="toggleModal(false)">
    <div class="info-modal" onclick="event.stopPropagation()">
      <div class="info-modal-header">
        <div class="info-modal-title"><span class="info-badge">ğŸ“±</span><span>ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span></div>
        <button class="info-close" onclick="toggleModal(false)">âœ•</button>
      </div>
      <div class="info-modal-body" style="text-align:center;">
        <b>iPhone:</b> Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© â¬†ï¸ Ø«Ù… "Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"<br><br>
        <b>Android:</b> Ù†Ù‚Ø§Ø· â‹® Ø«Ù… "Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"
      </div>
      <div class="info-modal-footer"><button class="info-ok" onclick="toggleModal(false)">ÙÙ‡Ù…Øª</button></div>
    </div>
  </div>

  <div id="infoOverlay" class="info-overlay" onclick="closeInfoModal()">
    <div class="info-modal" onclick="event.stopPropagation()">
      <div class="info-modal-header">
        <div class="info-modal-title"><span class="info-badge" id="infoBadge">i</span><span id="infoTitle">Ù…Ø¹Ù„ÙˆÙ…Ø©</span></div>
        <button class="info-close" onclick="closeInfoModal()">âœ•</button>
      </div>
      <div class="info-modal-body"><div id="infoText"></div><div id="infoFormula" class="info-formula" style="display:none;"></div></div>
      <div class="info-modal-footer"><button class="info-ok" onclick="closeInfoModal()">ÙÙ‡Ù…Øª</button></div>
    </div>
  </div>

  <div class="app-container">
    <div class="install-banner">
      <div class="install-text">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ÙƒØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ Ø§Ù„Ø°ÙƒÙŠ</div>
      <button class="install-btn" onclick="toggleModal(true)">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©</button>
    </div>
    <header class="header-section"><div class="header-text"><h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠØ©</h1></div></header>
    <div class="action-bars"><button class="add-btn" onclick="addNewCourse()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯</button><button class="reset-all" onclick="clearEverything()">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button></div>
    <div id="coursesList"></div>
    <footer class="footer-note"><p style="font-weight:bold; color:var(--primary); margin:0;">ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ø£. Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø«Ø§Ù…ÙŠ</p><p class="year">1447Ù‡Ù€ | 2026Ù…</p></footer>
  </div>

<script>
  let courses = JSON.parse(localStorage.getItem('myCourses')) || [];
  const SYSTEM_WEEKS = 19;
  const DEPRIVATION_RATE = 0.20;
  const EPS = 1e-9;

  function ceilLimit(totalLectures){ return Math.ceil((totalLectures * DEPRIVATION_RATE) - EPS); }
  function floor1(x){ return Math.floor((Number(x)||0) * 10) / 10; }
  function lectureWord(n){ return (Math.abs(parseInt(n||0,10)) === 1) ? "Ù„Ù‚Ø§Ø¡" : "Ù„Ù‚Ø§Ø¡Ø§Øª"; }
  function $(id){ return document.getElementById(id); }

  function fixNumbers(str) { return String(str || '').replace(/[Ù -Ù©]/g, d => String(d.charCodeAt(0) - 1632)).replace(/[^\d]/g, ''); }

  function toggleModal(show) { $('guideModal').style.display = show ? 'flex' : 'none'; }
  function closeInfoModal() { $('infoOverlay').style.display = 'none'; }

  function addNewCourse() {
    courses.push({ id: Date.now(), name: 'Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±', meetings: [{ day: 'Ø§Ù„Ø£Ø­Ø¯', dur: 2, type: 'Ù†Ø¸Ø±ÙŠ', absent: '' }] });
    renderCourses();
  }

  function addMeeting(courseId){
    const i = courses.findIndex(c => c.id === courseId);
    if (i !== -1 && courses[i].meetings.length < 3) { courses[i].meetings.push({ day:'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', dur:1, type:'Ø¹Ù…Ù„ÙŠ', absent:'' }); renderCourses(); }
  }

  function removeMeeting(courseId){
    const i = courses.findIndex(c => c.id === courseId);
    if (i !== -1 && courses[i].meetings.length > 1) { courses[i].meetings.pop(); renderCourses(); }
  }

  function updateMeeting(courseId, idx, field, value, doRender = true){
    const i = courses.findIndex(c => c.id === courseId);
    if (i === -1) return;
    const m = courses[i].meetings[idx];
    if (field === 'absent') m.absent = fixNumbers(value);
    else m[field] = (field==='dur') ? Number(value) : value;
    if (doRender) renderCourses();
    else updateCourseUI(courseId);
  }

  function openLimitInfo(courseId){
    const course = courses.find(c => c.id === courseId);
    const s = computeCourseState(course);
    const text = `ğŸ”´ ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø­Ø±Ù…Ø§Ù† Ø¹Ù†Ø¯ ØºÙŠØ§Ø¨ <span class="num">${s.limitAll}</span> Ù„Ù‚Ø§Ø¡.`;
    $('infoTitle').textContent = 'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨';
    $('infoText').innerHTML = text;
    $('infoOverlay').style.display = 'flex';
  }

  function computeCourseState(course){
    let totalTheory = 0, totalPrac = 0, absentTheory = 0, absentPrac = 0;
    let hasTheory = false, hasPrac = false;

    course.meetings.forEach(m => {
      let count = SYSTEM_WEEKS;
      let abs = parseInt(m.absent) || 0;
      if (m.type === 'Ù†Ø¸Ø±ÙŠ') { totalTheory += count; absentTheory += abs; hasTheory = true; }
      else { totalPrac += count; absentPrac += abs; hasPrac = true; }
    });

    let limitTheoryReal = ceilLimit(totalTheory);
    let limitPracReal = ceilLimit(totalPrac);

    // Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨ØªÙŠÙ‡ Ù„ÙŠÙƒÙˆÙ† Ø§Ù„Ø¹Ø±Ø¶ (Ø§Ù„Ø­Ø¯ - 1)
    let displayLimitT = limitTheoryReal - 1;
    let displayLimitP = limitPracReal - 1;

    let isDeprived = (hasTheory && absentTheory >= limitTheoryReal) || (hasPrac && absentPrac >= limitPracReal);
    let maxPct = Math.max(hasTheory ? (absentTheory/totalTheory)*100 : 0, hasPrac ? (absentPrac/totalPrac)*100 : 0);

    let status = { class: 'safe-bg', color: 'var(--safe)', msg: 'ğŸŸ¢ ÙˆØ¶Ø¹Ùƒ Ø¢Ù…Ù†' };
    if (isDeprived) { status = { class: 'danger-bg', color: 'var(--danger)', msg: 'ğŸ”´ Ø­Ø§Ù„Ø© Ø­Ø±Ù…Ø§Ù†' }; }
    else if (maxPct >= 15) { status = { class: 'warning-bg', color: 'var(--orange)', msg: 'ğŸŸ  ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø±Ø¬' }; }
    else if (maxPct >= 10) { status = { class: 'warning-bg', color: 'var(--warning)', msg: 'ğŸŸ¡ Ø§Ù†ØªØ¨Ø§Ù‡ Ù„ØºÙŠØ§Ø¨Ùƒ' }; }

    let advice = '<div class="advice-box">';
    if (isDeprived) advice += '<b style="color:red">ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ (Ø­Ø±Ù…Ø§Ù†)!</b>';
    else {
      if (hasTheory) {
        let remT = displayLimitT - absentTheory;
        advice += `<div><b>Ø§Ù„Ù†Ø¸Ø±ÙŠ:</b> ØºÙŠØ§Ø¨Ùƒ <span class="primary-num">${absentTheory}</span> Ù…Ù† <span class="primary-num">${displayLimitT}</span> â€” ÙŠØªØ¨Ù‚Ù‰ Ù„Ùƒ <span class="primary-num">${remT}</span> ${lectureWord(remT)}</div>`;
      }
      if (hasPrac) {
        let remP = displayLimitP - absentPrac;
        advice += `<div style="margin-top:5px;"><b>Ø§Ù„Ø¹Ù…Ù„ÙŠ:</b> ØºÙŠØ§Ø¨Ùƒ <span class="primary-num">${absentPrac}</span> Ù…Ù† <span class="primary-num">${displayLimitP}</span> â€” ÙŠØªØ¨Ù‚Ù‰ Ù„Ùƒ <span class="primary-num">${remP}</span> ${lectureWord(remP)}</div>`;
      }
    }
    advice += '</div>';

    return { ...status, percentShown: floor1(maxPct), advice, limitAll: limitTheoryReal, absentAll: absentTheory+absentPrac, totalLecturesAll: totalTheory+totalPrac };
  }

  function updateCourseUI(courseId){
    const course = courses.find(c => c.id === courseId);
    const s = computeCourseState(course);
    const res = $(`resultBox-${courseId}`);
    if (res) {
      res.className = `result-area ${s.class}`;
      $(`statusMsg-${courseId}`).textContent = s.msg;
      $(`statusMsg-${courseId}`).style.color = s.color;
      $(`barFill-${courseId}`).style.width = `${Math.min((s.percentShown / 20) * 100, 100)}%`;
      $(`barFill-${courseId}`).style.background = s.color;
      $(`adviceBox-${courseId}`).innerHTML = s.advice;
    }
    localStorage.setItem('myCourses', JSON.stringify(courses));
  }

  function renderCourses() {
    const list = $('coursesList');
    list.innerHTML = '';
    courses.forEach(course => {
      const s = computeCourseState(course);
      const card = document.createElement('div');
      card.className = 'course-card';
      card.innerHTML = `
        <button class="delete-course" onclick="deleteCourse(${course.id})">âœ•</button>
        <input type="text" class="course-title" value="${course.name}" onchange="updateCourse(${course.id}, 'name', this.value)">
        <div class="input-group">
          <label style="text-align:center;">Ù„Ù‚Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ø±</label>
          <div id="meetWrap-${course.id}"></div>
          <div style="display:flex; gap:8px; margin-top:10px;">
            <button class="reset-all" onclick="addMeeting(${course.id})">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù‚Ø§Ø¡</button>
            <button class="reset-all" onclick="removeMeeting(${course.id})">â– Ø­Ø°Ù Ù„Ù‚Ø§Ø¡</button>
          </div>
        </div>
        <div class="result-area ${s.class}" id="resultBox-${course.id}">
          <div id="statusMsg-${course.id}" style="font-weight:800; color:${s.color};">${s.msg}</div>
          <div class="progress-bar"><div id="barFill-${course.id}" class="progress-fill" style="width:${Math.min((s.percentShown/20)*100,100)}%; background:${s.color}"></div></div>
          <div id="adviceBox-${course.id}">${s.advice}</div>
        </div>
      `;
      list.appendChild(card);
      $(`meetWrap-${course.id}`).innerHTML = course.meetings.map((m, idx) => `
        <div class="flex-inputs" style="margin-top:8px;">
          <div><div class="input-sub-label">Ø§Ù„ÙŠÙˆÙ…</div><select onchange="updateMeeting(${course.id}, ${idx}, 'day', this.value)">${['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³'].map(d => `<option value="${d}" ${m.day===d?'selected':''}>${d}</option>`).join('')}</select></div>
          <div><div class="input-sub-label">Ø§Ù„Ù†ÙˆØ¹</div><select onchange="updateMeeting(${course.id}, ${idx}, 'type', this.value)"><option value="Ù†Ø¸Ø±ÙŠ" ${m.type==='Ù†Ø¸Ø±ÙŠ'?'selected':''}>Ù†Ø¸Ø±ÙŠ</option><option value="Ø¹Ù…Ù„ÙŠ" ${m.type==='Ø¹Ù…Ù„ÙŠ'?'selected':''}>Ø¹Ù…Ù„ÙŠ</option></select></div>
          <div><div class="input-sub-label">Ø§Ù„ØºÙŠØ§Ø¨</div><input type="text" inputmode="numeric" value="${m.absent}" oninput="updateMeeting(${course.id}, ${idx}, 'absent', this.value, false)"></div>
        </div>`).join('');
    });
    localStorage.setItem('myCourses', JSON.stringify(courses));
  }

  function updateCourse(id, field, value) { const idx = courses.findIndex(c => c.id === id); courses[idx][field] = value; renderCourses(); }
  function deleteCourse(id) { if (confirm('Ø­Ø°ÙØŸ')) { courses = courses.filter(c => c.id !== id); renderCourses(); } }
  function clearEverything() { if (confirm('Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·ØŸ')) { courses = []; localStorage.removeItem('myCourses'); renderCourses(); } }
  window.onload = renderCourses;
</script>
</body>
</html>
