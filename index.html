<!DOCTYPE html>  
<html lang="ar" dir="rtl">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-35NPHCGB93"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-35NPHCGB93');
  </script>

  <link rel="apple-touch-icon" href="1024.png">
  <link rel="icon" href="1024.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØºÙŠØ§Ø¨</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #006699;
      --secondary: #00aed9;
      --text-dark: #2c3e50;
      --safe: #22c55e;
      --warning: #facc15;
      --orange: #fb923c;
      --danger: #ef4444;
      --bg-gradient: linear-gradient(135deg, #e6f4f8 0%, #ffffff 100%);
      --info-modal-bg: #ffffff;
      --info-modal-text: #1f2937;
      --info-modal-accent: #0EA5E9;
    }

    .num{
      direction: ltr;
      unicode-bidi: bidi-override;
      display: inline-block;
      font-weight: 800;
    }

    .formula-line{
      direction: rtl;
      unicode-bidi: isolate-override;
      text-align: center;
      white-space: nowrap;
    }

    body {
      margin: 0;
      font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif;
      background: var(--bg-gradient);
      padding: 20px 10px;
      direction: rtl;
      min-height: 100vh;
    }

    .install-banner {
      background: #ffffff;
      border: 1px solid #e1e9e7;
      padding: 4px 12px;
      border-radius: 14px;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 3px 8px rgba(0,0,0,0.03);
    }

    .install-text {
      font-weight: 600;
      color: var(--primary);
      font-size: 0.78rem;
    }

    .install-btn {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 4px 12px;
      border-radius: 10px;
      font-size: 0.72rem;
      font-weight: bold;
      cursor: pointer;
    }

    .app-container { max-width: 450px; margin: 0 auto; }
    .header-section { text-align: center; margin-bottom: 20px; }

    .header-text h1 {
      margin: 0;
      font-size: clamp(1.9rem, 4.8vw, 2.5rem);
      font-weight: 800;
      color: var(--primary);
      letter-spacing: 0.3px;
    }

    .action-bars { display: flex; gap: 10px; margin: 20px 0; }
    .add-btn {
      flex: 2;
      padding: 14px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border: none;
      border-radius: 16px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.05rem;
      letter-spacing: 0.3px;
      box-shadow: 0 4px 12px rgba(0, 102, 153, 0.2);
    }
    .reset-all {
      flex: 1;
      padding: 12px;
      background: #fff;
      color: var(--primary);
      border: 1px solid var(--primary);
      border-radius: 16px;
      cursor: pointer;
      font-weight: bold;
    }

    .course-card {
      background: white;
      border-radius: 28px;
      padding: 22px;
      margin-bottom: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.06);
      border: 1px solid #d1e2e8;
      position: relative;
    }

    .delete-course {
      position: absolute;
      top: 18px;
      left: 18px;
      background: #fee2e2;
      color: #ef4444;
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .course-title {
      width: 85%;
      border: none;
      border-bottom: 2px solid #f0f0f0;
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 15px;
      padding: 5px;
      outline: none;
      background: transparent;
    }

    .input-group { margin-bottom: 12px; }
    .input-group label {
      display: block;
      font-size: 0.9rem;
      color: #334155;
      margin-bottom: 6px;
      font-weight: 800;
      background: #f0f7f9;
      padding: 6px 12px;
      border-right: 3px solid var(--secondary);
    }

    .input-sub-label {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2px;
      font-weight: 600;
      width: 100%;      
      white-space: nowrap;
    }

    .info-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      background: var(--info-modal-accent);
      color: white;
      border-radius: 999px;
      font-size: 0.78rem;
      margin-right: 6px;
      cursor: pointer;
      font-weight: 900;
      vertical-align: middle;
      box-shadow: 0 6px 14px rgba(14,165,233,0.25);
    }

    .result-area { border-radius: 20px; padding: 15px; margin-top: 15px; text-align: center; }
    .safe-bg { background: #f0fdf4; border: 1px solid #dcfce7; }
    .warning-bg { background: #fffbeb; border: 1px solid #fef3c7; }
    .danger-bg { background: #fef2f2; border: 1px solid #fee2e2; }

    .progress-bar { height: 8px; background: #e5e7eb; border-radius: 4px; margin: 10px 0; overflow: hidden; }
    .progress-fill { height: 100%; width: 0%; transition: 0.8s ease-in-out; }

    .advice-box {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed rgba(0,0,0,0.1);
      font-size: 0.85rem;
      color: #444;
      line-height: 1.4;
    }
    .advice-box b { color: var(--primary); }

    .footer-note {
      text-align: center;
      font-size: 0.8rem;
      color: #718096;
      margin-top: 40px;
      border-top: 1px solid #d1d9e6;
      padding-top: 20px;
    }

    .info-overlay{
      display:none;
      position:fixed;
      inset:0;
      background: rgba(15, 23, 42, 0.55);
      z-index: 10000;
      justify-content:center;
      align-items:center;
      padding: 14px;
    }

    .info-modal{
      width: 92%;
      max-width: 360px;
      background: var(--info-modal-bg);
      color: var(--info-modal-text);
      border-radius: 20px;
      box-shadow: 0 18px 45px rgba(0,0,0,0.25);
      overflow: hidden;
    }

    .info-modal-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.08);
    }

    .info-ok{
      width:100%;
      background: var(--info-modal-accent);
      color: white;
      border: none;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 900;
      cursor: pointer;
    }

    select, input {
      width: 100%;
      height: 42px; 
      padding: 5px;
      border-radius: 12px;
      border: 1.5px solid #edf2f1;
      font-family: inherit;
      text-align: center;
      font-size: 0.95rem;
      font-weight: 800;
      background-color: #eeeeee; 
      color: #006699; 
    }

    .flex-inputs { 
      display: flex; 
      gap: 5px; 
      align-items: flex-end; 
    }
    
    .flex-inputs > div { 
      flex: 1; 
      min-width: 0; 
    }
    .primary-num { color: var(--primary); font-weight: 900; }
  </style>
</head>

<body>

  <div id="guideModal" class="info-overlay" onclick="toggleModal(false)">
    <div class="info-modal" onclick="event.stopPropagation()">
      <div class="info-modal-header">
        <div style="font-weight:900;">ğŸ“± Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø­Ø³Ø§Ø¨</div>
        <button onclick="toggleModal(false)" style="border:none; background:none; cursor:pointer;">âœ•</button>
      </div>
      <div style="padding: 20px; text-align:center;">
        <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ù„ØµÙØ­ØªÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¹Ø¨Ø± Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ (Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©).</p>
        <button class="info-ok" onclick="toggleModal(false)">ÙÙ‡Ù…Øª</button>
      </div>
    </div>
  </div>

  <div id="infoOverlay" class="info-overlay" onclick="closeInfoModal()">
    <div class="info-modal" onclick="event.stopPropagation()">
      <div class="info-modal-header">
        <div id="infoTitle" style="font-weight:900;">Ù…Ø¹Ù„ÙˆÙ…Ø©</div>
        <button onclick="closeInfoModal()" style="border:none; background:none; cursor:pointer;">âœ•</button>
      </div>
      <div style="padding: 20px;">
        <div id="infoText"></div>
      </div>
      <div style="padding: 0 16px 16px 16px;">
        <button class="info-ok" onclick="closeInfoModal()">ÙÙ‡Ù…Øª</button>
      </div>
    </div>
  </div>

  <div class="app-container">
    <div class="install-banner">
      <div class="install-text">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ÙƒØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ</div>
      <button class="install-btn" onclick="toggleModal(true)">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©</button>
    </div>

    <header class="header-section">
      <div class="header-text">
        <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠØ©</h1>
      </div>
    </header>

    <div class="action-bars">
      <button class="add-btn" onclick="addNewCourse()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯</button>
      <button class="reset-all" onclick="clearEverything()">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>

    <div id="coursesList"></div>

    <footer class="footer-note">
      <p style="font-weight:bold; color:var(--primary);">ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ø£. Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø«Ø§Ù…ÙŠ</p>
      <p>1447Ù‡Ù€ | 2026Ù…</p>
    </footer>
  </div>

<script>
  let courses = JSON.parse(localStorage.getItem('myCourses')) || [];
  const SYSTEM_WEEKS = 19;
  const DEPRIVATION_RATE = 0.20;
  const EPS = 1e-9;

  function ceilLimit(totalLectures){
    return Math.ceil((totalLectures * DEPRIVATION_RATE) - EPS); 
  }
  
  function floor1(x){
    return Math.floor((Number(x)||0) * 10) / 10; 
  }

  function lectureWord(n){
    n = Math.abs(parseInt(n||0,10));
    if (n === 1) return "Ù„Ù‚Ø§Ø¡";
    if (n === 2) return "Ù„Ù‚Ø§Ø¡ÙŠÙ†";
    if (n >= 3 && n <= 10) return "Ù„Ù‚Ø§Ø¡Ø§Øª";
    return "Ù„Ù‚Ø§Ø¡";
  }

  function $(id){ return document.getElementById(id); }

  function toggleModal(show) {
    $('guideModal').style.display = show ? 'flex' : 'none';
  }

  function fixNumbers(str) {
    return String(str || '').replace(/[Ù -Ù©]/g, d => String(d.charCodeAt(0) - 1632)).replace(/[^\d]/g, '');
  }

  function addNewCourse() {
    courses.push({
      id: Date.now(),
      name: 'Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±',
      meetings: [{ day: 'Ø§Ù„Ø£Ø­Ø¯', dur: 2, type: 'Ù†Ø¸Ø±ÙŠ', absent: '' }]
    });
    renderCourses();
  }

  function openInfoModal({title='Ù…Ø¹Ù„ÙˆÙ…Ø©', text=''}) {
    $('infoTitle').textContent = title;
    $('infoText').innerHTML = text;
    $('infoOverlay').style.display = 'flex';
  }

  function closeInfoModal() { $('infoOverlay').style.display = 'none'; }

  function openLimitInfo(courseId){
    const course = courses.find(c => c.id === courseId);
    if (!course) return;
    const s = computeCourseState(course);
    const text = `<div style="line-height:1.8;"><b>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨:</b><br>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„Ù‚Ø§Ø¡Ø§Øª: ${s.totalLecturesAll}<br>Ø­Ø¯ Ø§Ù„Ø­Ø±Ù…Ø§Ù† (20%): ${s.limitAll}<br><br><span style="color:red;">Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØªÙ… Ø§Ù„Ø­Ø±Ù…Ø§Ù† Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø°ÙƒÙˆØ±.</span></div>`;
    openInfoModal({ title: 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨', text });
  }

  function computeCourseState(course){
    const cleanMeetings = (course.meetings || []).map(m => ({
      type: m.type === 'Ø¹Ù…Ù„ÙŠ' ? 'Ø¹Ù…Ù„ÙŠ' : 'Ù†Ø¸Ø±ÙŠ',
      absent: parseInt(m.absent, 10) || 0
    }));

    const weeklyByType = { 'Ù†Ø¸Ø±ÙŠ': 0, 'Ø¹Ù…Ù„ÙŠ': 0 };
    cleanMeetings.forEach(m => weeklyByType[m.type]++);

    const totalByType = {
      'Ù†Ø¸Ø±ÙŠ': weeklyByType['Ù†Ø¸Ø±ÙŠ'] * SYSTEM_WEEKS,
      'Ø¹Ù…Ù„ÙŠ': weeklyByType['Ø¹Ù…Ù„ÙŠ'] * SYSTEM_WEEKS
    };

    const limitByType = {
      'Ù†Ø¸Ø±ÙŠ': ceilLimit(totalByType['Ù†Ø¸Ø±ÙŠ']),
      'Ø¹Ù…Ù„ÙŠ': ceilLimit(totalByType['Ø¹Ù…Ù„ÙŠ'])
    };

    const absentByType = { 'Ù†Ø¸Ø±ÙŠ': 0, 'Ø¹Ù…Ù„ÙŠ': 0 };
    cleanMeetings.forEach(m => { absentByType[m.type] += m.absent; });

    const pctTheory = totalByType['Ù†Ø¸Ø±ÙŠ'] ? (absentByType['Ù†Ø¸Ø±ÙŠ'] / totalByType['Ù†Ø¸Ø±ÙŠ']) * 100 : 0;
    const pctPrac = totalByType['Ø¹Ù…Ù„ÙŠ'] ? (absentByType['Ø¹Ù…Ù„ÙŠ'] / totalByType['Ø¹Ù…Ù„ÙŠ']) * 100 : 0;
    
    const isDeprived = (totalByType['Ù†Ø¸Ø±ÙŠ'] && absentByType['Ù†Ø¸Ø±ÙŠ'] >= limitByType['Ù†Ø¸Ø±ÙŠ']) || 
                       (totalByType['Ø¹Ù…Ù„ÙŠ'] && absentByType['Ø¹Ù…Ù„ÙŠ'] >= limitByType['Ø¹Ù…Ù„ÙŠ']);

    let statusClass = 'safe-bg', statusColor = 'var(--safe)', msg = 'ğŸŸ¢ ÙˆØ¶Ø¹Ùƒ Ø¢Ù…Ù† ÙˆÙ…Ø³ØªÙ‚Ø±';
    const focusPct = Math.max(pctTheory, pctPrac);

    if (isDeprived) { statusClass = 'danger-bg'; statusColor = 'var(--danger)'; msg = 'ğŸ”´ Ø­Ø§Ù„Ø© Ø­Ø±Ù…Ø§Ù†'; }
    else if (focusPct >= 15) { statusClass = 'warning-bg'; statusColor = 'var(--orange)'; msg = 'ğŸŸ  ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† Ø§Ù„Ø­Ø±Ù…Ø§Ù†'; }
    else if (focusPct >= 10) { statusClass = 'warning-bg'; statusColor = 'var(--warning)'; msg = 'ğŸŸ¡ Ø§Ù†ØªØ¨Ø§Ù‡: Ø¨Ø¯Ø£ Ø±ØµÙŠØ¯Ùƒ Ø¨Ø§Ù„Ù†Ù‚ØµØ§Ù†'; }

    let advice = '';
    if (isDeprived) {
      advice = `<div class="advice-box" style="color:#dc2626; font-weight:900;">ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ ÙÙŠ Ø§Ù„Ù…Ù‚Ø±Ø±.</div>`;
    } else {
      let lines = [];
      ['Ù†Ø¸Ø±ÙŠ', 'Ø¹Ù…Ù„ÙŠ'].forEach(type => {
        if (totalByType[type] > 0) {
          // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ Ù‡Ù†Ø§: Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù‡Ùˆ (Ø§Ù„Ø­Ø¯ - 1) Ù†Ø§Ù‚Øµ Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
          const allowedLimit = limitByType[type] - 1;
          const remaining = allowedLimit - absentByType[type];
          let remColor = remaining <= 0 ? 'var(--orange)' : (remaining === 1 ? 'var(--warning)' : 'var(--safe)');
          
          lines.push(`<div style="margin-bottom:6px;">
            <b style="color:var(--primary);">${type}:</b> ØºÙŠØ§Ø¨Ùƒ <span class="primary-num">${absentByType[type]}</span> Ù…Ù† <span class="primary-num">${limitByType[type]}</span> â€” 
            <span style="color:${remColor}; font-weight:900;">ÙŠØªØ¨Ù‚Ù‰ Ù„Ùƒ <span class="primary-num">${remaining}</span> ${lectureWord(remaining)}</span>
          </div>`);
        }
      });
      advice = `<div class="advice-box">${lines.join('')}</div>`;
    }

    const totalLecturesAll = (weeklyByType['Ù†Ø¸Ø±ÙŠ'] + weeklyByType['Ø¹Ù…Ù„ÙŠ']) * SYSTEM_WEEKS;
    return {
      percentShown: floor1(focusPct),
      statusClass, statusColor, msg, advice,
      totalLecturesAll,
      absentAll: absentByType['Ù†Ø¸Ø±ÙŠ'] + absentByType['Ø¹Ù…Ù„ÙŠ'],
      limitAll: ceilLimit(totalLecturesAll)
    };
  }

  function renderCourses() {
    const list = $('coursesList');
    list.innerHTML = '';
    courses.forEach(course => {
      const s = computeCourseState(course);
      const card = document.createElement('div');
      card.className = 'course-card';
      card.innerHTML = `
        <button class="delete-course" onclick="deleteCourse(${course.id})">âœ•</button>
        <input type="text" class="course-title" value="${course.name}" onchange="updateCourse(${course.id}, 'name', this.value)">
        <div id="meetWrap-${course.id}"></div>
        <div style="display:flex; gap:8px; margin-top:10px;">
          <button class="reset-all" onclick="addMeeting(${course.id})">â• Ù„Ù‚Ø§Ø¡</button>
          <button class="reset-all" onclick="removeMeeting(${course.id})">â– Ø­Ø°Ù</button>
        </div>
        <div class="result-area ${s.statusClass}" id="resultBox-${course.id}">
          <div style="font-weight:800; color:${s.statusColor};">${s.msg}</div>
          <div style="font-size:1.8rem; font-weight:900; color:var(--primary);">${s.percentShown}%</div>
          <div class="progress-bar"><div class="progress-fill" style="width:${Math.min((s.percentShown / 20) * 100, 100)}%; background:${s.statusColor}"></div></div>
          <div id="adviceBox-${course.id}">${s.advice}</div>
        </div>
      `;
      list.appendChild(card);
      
      const wrap = card.querySelector(`#meetWrap-${course.id}`);
      wrap.innerHTML = (course.meetings || []).map((m, idx) => `
        <div class="flex-inputs" style="margin-top:8px;">
          <div><div class="input-sub-label">Ø§Ù„Ù†ÙˆØ¹</div><select onchange="updateMeeting(${course.id}, ${idx}, 'type', this.value)"><option value="Ù†Ø¸Ø±ÙŠ" ${m.type==='Ù†Ø¸Ø±ÙŠ'?'selected':''}>Ù†Ø¸Ø±ÙŠ</option><option value="Ø¹Ù…Ù„ÙŠ" ${m.type==='Ø¹Ù…Ù„ÙŠ'?'selected':''}>Ø¹Ù…Ù„ÙŠ</option></select></div>
          <div><div class="input-sub-label">Ø§Ù„ØºÙŠØ§Ø¨</div><input type="text" inputmode="numeric" value="${m.absent||''}" oninput="this.value=fixNumbers(this.value); updateMeeting(${course.id}, ${idx}, 'absent', this.value)"></div>
        </div>`).join('');
    });
    localStorage.setItem('myCourses', JSON.stringify(courses));
  }

  function addMeeting(id) {
    const c = courses.find(x => x.id === id);
    if(c && c.meetings.length < 3) { c.meetings.push({type:'Ø¹Ù…Ù„ÙŠ', absent:''}); renderCourses(); }
  }
  function removeMeeting(id) {
    const c = courses.find(x => x.id === id);
    if(c && c.meetings.length > 1) { c.meetings.pop(); renderCourses(); }
  }
  function updateMeeting(id, idx, field, val) {
    const c = courses.find(x => x.id === id);
    if(c) { 
      if(field==='absent') c.meetings[idx].absent = fixNumbers(val);
      else c.meetings[idx][field] = val;
      renderCourses(); 
    }
  }
  function updateCourse(id, field, val) {
    const c = courses.find(x => x.id === id);
    if(c) { c[field] = val; renderCourses(); }
  }
  function deleteCourse(id) { if(confirm('Ø­Ø°ÙØŸ')) { courses = courses.filter(x => x.id !== id); renderCourses(); } }
  function clearEverything() { if(confirm('Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ØŸ')) { courses = []; localStorage.clear(); renderCourses(); } }

  window.onload = renderCourses;
</script>
</body>
</html>
